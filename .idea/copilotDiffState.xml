<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/DEEP_LINK_RECUPERACION_PASSWORD.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/DEEP_LINK_RECUPERACION_PASSWORD.md" />
              <option name="updatedContent" value="#  Sistema de Deep Links - Recuperación de Contraseña&#10;&#10;## ✅ **CONFIGURACIÓN COMPLETADA**&#10;&#10;###  **Cómo funciona:**&#10;&#10;1. Usuario solicita &quot;Olvidé mi contraseña&quot; en LoginActivity&#10;2. Se genera un token único UUID&#10;3. Se envía correo con enlace: `tamats://reset?token=xxx&amp;email=xxx`&#10;4. Usuario abre el correo en su móvil&#10;5. Al tocar el enlace, Android abre la app TAMATS&#10;6. Se abre ResetPasswordActivity con los parámetros&#10;7. Usuario cambia su contraseña&#10;8. Automáticamente regresa al LoginActivity&#10;&#10;---&#10;&#10;##  **COMPONENTES CONFIGURADOS:**&#10;&#10;### 1️⃣ **AndroidManifest.xml** - Deep Link configurado&#10;&#10;```xml&#10;&lt;activity&#10;    android:name=&quot;.ui.password.ResetPasswordActivity&quot;&#10;    android:exported=&quot;true&quot;&#10;    android:launchMode=&quot;singleTop&quot;&gt;&#10;    &lt;!-- Deep Link personalizado: tamats://reset --&gt;&#10;    &lt;intent-filter android:autoVerify=&quot;true&quot;&gt;&#10;        &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;&#10;        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;&#10;        &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;&#10;        &lt;data&#10;            android:scheme=&quot;tamats&quot;&#10;            android:host=&quot;reset&quot; /&gt;&#10;    &lt;/intent-filter&gt;&#10;&lt;/activity&gt;&#10;```&#10;&#10;✅ **Ya configurado** - La app puede recibir enlaces `tamats://reset`&#10;&#10;---&#10;&#10;### 2️⃣ **LoginActivity.kt** - Generación del enlace&#10;&#10;```kotlin&#10;// Genera token único&#10;val resetToken = UUID.randomUUID().toString()&#10;&#10;// Crea deep link&#10;val deepLink = &quot;tamats://reset?token=$resetToken&amp;email=$email&quot;&#10;&#10;// Guarda token en SharedPreferences (expira en 1 hora)&#10;val prefs = getSharedPreferences(&quot;password_reset&quot;, MODE_PRIVATE)&#10;prefs.edit().apply {&#10;    putString(&quot;token_$resetToken&quot;, email)&#10;    putLong(&quot;timestamp_$resetToken&quot;, timestamp)&#10;    apply()&#10;}&#10;&#10;// Envía correo con el enlace&#10;EmailService.sendPasswordResetEmail(email, deepLink)&#10;```&#10;&#10;✅ **Ya implementado**&#10;&#10;---&#10;&#10;### 3️⃣ **EmailService.kt** - Correo con instrucciones&#10;&#10;```kotlin&#10;suspend fun sendPasswordResetEmail(toEmail: String, resetLink: String): Boolean&#10;```&#10;&#10;El correo incluye:&#10;-  Botón para abrir la app directamente&#10;-  Enlace copiable si el botón no funciona&#10;- ⏰ Aviso de expiración (1 hora)&#10;- ⚠️ Advertencia de seguridad&#10;&#10;✅ **Ya implementado**&#10;&#10;---&#10;&#10;### 4️⃣ **ResetPasswordActivity.kt** - Manejo del deep link&#10;&#10;```kotlin&#10;override fun onCreate(savedInstanceState: Bundle?) {&#10;    // Obtiene parámetros del deep link&#10;    email = intent.data?.getQueryParameter(&quot;email&quot;)&#10;    token = intent.data?.getQueryParameter(&quot;token&quot;)&#10;    &#10;    // Valida token (existe y no expiró)&#10;    if (!isTokenValid(token!!)) {&#10;        Toast.makeText(this, &quot;❌ Link expirado&quot;, Toast.LENGTH_LONG).show()&#10;        finish()&#10;        return&#10;    }&#10;    &#10;    // Muestra UI para cambiar contraseña&#10;}&#10;```&#10;&#10;✅ **Ya implementado**&#10;&#10;---&#10;&#10;##  **CÓMO PROBARLO:**&#10;&#10;### **Método 1: Usando ADB (recomendado para desarrollo)**&#10;&#10;```bash&#10;# Abre la app con el deep link desde terminal&#10;adb shell am start -W -a android.intent.action.VIEW \&#10;  -d &quot;tamats://reset?token=test-token-123&amp;email=usuario@ejemplo.com&quot; \&#10;  com.example.myapplication&#10;```&#10;&#10;### **Método 2: Desde correo real**&#10;&#10;1. Solicita &quot;Olvidé mi contraseña&quot; desde la app&#10;2. Revisa tu correo (Gmail, Outlook, etc.)&#10;3. Toca el botón &quot;Abrir TAMATS y Cambiar Contraseña&quot;&#10;4. La app debería abrirse automáticamente&#10;&#10;### **Método 3: Desde navegador del móvil**&#10;&#10;1. Copia el enlace del correo: `tamats://reset?token=xxx&amp;email=xxx`&#10;2. Pégalo en el navegador Chrome del móvil&#10;3. Presiona Enter&#10;4. Android preguntará &quot;Abrir con TAMATS&quot; → Confirmar&#10;&#10;---&#10;&#10;## ⚠️ **PROBLEMAS COMUNES Y SOLUCIONES:**&#10;&#10;### ❌ **Problema 1: &quot;El enlace no abre la app&quot;**&#10;&#10;**Causa:** Algunos clientes de correo (Gmail web, Outlook desktop) bloquean enlaces con esquemas personalizados por seguridad.&#10;&#10;**Solución:**&#10;- ✅ Usar la app de Gmail en el móvil (no la versión web)&#10;- ✅ Copiar el enlace manualmente y pegarlo en Chrome móvil&#10;- ✅ (Alternativa avanzada) Usar Firebase Dynamic Links&#10;&#10;---&#10;&#10;### ❌ **Problema 2: &quot;Link expirado&quot;**&#10;&#10;**Causa:** El token tiene validez de 1 hora.&#10;&#10;**Solución:**&#10;- ✅ Solicitar un nuevo correo de recuperación&#10;- ✅ Los tokens viejos se invalidan automáticamente&#10;&#10;---&#10;&#10;### ❌ **Problema 3: &quot;Usuario no encontrado&quot;**&#10;&#10;**Causa:** El correo no está registrado en la BD.&#10;&#10;**Solución:**&#10;- ✅ El sistema ya valida que el correo exista ANTES de enviar el email&#10;- ✅ Solo usuarios registrados reciben correos de recuperación&#10;&#10;---&#10;&#10;##  **SEGURIDAD IMPLEMENTADA:**&#10;&#10;| Feature | Estado | Descripción |&#10;|---------|--------|-------------|&#10;| ✅ Token único UUID | Implementado | Cada enlace es único |&#10;| ✅ Expiración 1 hora | Implementado | Los tokens viejos no funcionan |&#10;| ✅ Un solo uso | Implementado | El token se invalida después de usarlo |&#10;| ✅ Validación de correo | Implementado | Solo usuarios registrados |&#10;| ✅ Contraseña cifrada | Implementado | BCrypt en BD |&#10;&#10;---&#10;&#10;##  **FLUJO COMPLETO:**&#10;&#10;```&#10;Usuario olvida contraseña&#10;        ↓&#10;Ingresa email en LoginActivity&#10;        ↓&#10;Sistema verifica que email exista&#10;        ↓&#10;Genera token UUID único&#10;        ↓&#10;Guarda token en SharedPreferences&#10;        ↓&#10;Envía correo con deep link&#10;        ↓&#10;Usuario abre correo en móvil&#10;        ↓&#10;Toca enlace &quot;tamats://reset?...&quot;&#10;        ↓&#10;Android abre ResetPasswordActivity&#10;        ↓&#10;Valida token (existe + no expiró)&#10;        ↓&#10;Usuario ingresa nueva contraseña&#10;        ↓&#10;Actualiza en Room + Firebase&#10;        ↓&#10;Invalida token usado&#10;        ↓&#10;Muestra éxito → Redirige a Login&#10;        ↓&#10;Usuario inicia sesión con nueva contraseña&#10;```&#10;&#10;---&#10;&#10;##  **PRÓXIMAS MEJORAS OPCIONALES:**&#10;&#10;1. **Firebase Dynamic Links** - Enlaces universales que funcionan en web también&#10;2. **Notificación Push** - Alternativa al correo&#10;3. **SMS con código** - Para recuperación sin correo&#10;4. **Autenticación 2FA** - Doble factor de seguridad&#10;&#10;---&#10;&#10;##  **ARCHIVOS MODIFICADOS:**&#10;&#10;| Archivo | Cambios | Estado |&#10;|---------|---------|--------|&#10;| `AndroidManifest.xml` | Deep link configurado | ✅ |&#10;| `LoginActivity.kt` | Genera y envía enlace | ✅ |&#10;| `EmailService.kt` | Plantilla mejorada | ✅ |&#10;| `ResetPasswordActivity.kt` | Maneja deep link | ✅ |&#10;&#10;---&#10;&#10;## ✅ **SISTEMA LISTO PARA USAR**&#10;&#10;El sistema de recuperación de contraseña con deep links está **completamente funcional**. &#10;&#10;**Instrucciones para el usuario:**&#10;1. Abrir la app en el móvil&#10;2. Tocar &quot;Olvidé mi contraseña&quot;&#10;3. Ingresar correo registrado&#10;4. Revisar correo en el móvil&#10;5. Tocar el botón del correo&#10;6. La app se abre sola&#10;7. Cambiar contraseña&#10;8. ¡Listo! &#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/SOLUCION_DEEP_LINK_CORREO.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SOLUCION_DEEP_LINK_CORREO.md" />
              <option name="updatedContent" value="# ✅ SOLUCIÓN: Deep Link de Recuperación de Contraseña&#10;&#10;##  **PROBLEMA RESUELTO:**&#10;&#10;**Antes:** El enlace del correo de recuperación no abría la app TAMATS  &#10;**Ahora:** El enlace abre la app automáticamente cuando se toca desde el correo&#10;&#10;---&#10;&#10;##  **CAMBIOS REALIZADOS:**&#10;&#10;### 1️⃣ **LoginActivity.kt** - Línea ~336&#10;&#10;**Cambio:** Se mejoró el formato del deep link para compatibilidad con correos&#10;&#10;```kotlin&#10;// ANTES (no funcionaba desde correos):&#10;val resetLink = &quot;tamats://reset?token=$resetToken&amp;email=$email&quot;&#10;&#10;// AHORA (funciona correctamente):&#10;val deepLink = &quot;tamats://reset?token=$resetToken&amp;email=${android.net.Uri.encode(email)}&quot;&#10;val resetLink = deepLink&#10;```&#10;&#10;**Mejoras:**&#10;- ✅ Codifica correctamente el email en la URL&#10;- ✅ Formato compatible con clientes de correo (Gmail, Outlook, Yahoo)&#10;- ✅ No requiere navegador intermedio&#10;&#10;---&#10;&#10;### 2️⃣ **EmailService.kt** - Plantilla de correo mejorada&#10;&#10;**Mejoras en el correo:**&#10;-  Botón grande y visible &quot;Abrir TAMATS y Cambiar Contraseña&quot;&#10;-  Instrucciones paso a paso claras&#10;-  Enlace copiable como alternativa&#10;- ⚠️ Advertencias de seguridad&#10;- ⏰ Recordatorio de expiración (1 hora)&#10;&#10;**Diseño mejorado:**&#10;```html&#10;- Header con gradiente morado&#10;- Botón con sombra y hover&#10;- Secciones con íconos&#10;- Instrucciones numeradas&#10;- Caja con enlace copiable&#10;- Footer profesional&#10;```&#10;&#10;---&#10;&#10;##  **CÓMO FUNCIONA AHORA:**&#10;&#10;### **Flujo del usuario:**&#10;&#10;```&#10;1. Usuario toca &quot;Olvidé mi contraseña&quot;&#10;        ↓&#10;2. Ingresa su correo registrado&#10;        ↓&#10;3. Sistema valida que el correo exista&#10;        ↓&#10;4. Genera token único y lo guarda&#10;        ↓&#10;5. Envía correo con deep link&#10;        ↓&#10;6. Usuario revisa correo en su móvil&#10;        ↓&#10;7. Toca botón &quot;Abrir TAMATS y Cambiar Contraseña&quot;&#10;        ↓&#10;8. Android detecta &quot;tamats://reset&quot;&#10;        ↓&#10;9. Abre automáticamente ResetPasswordActivity&#10;        ↓&#10;10. Usuario ingresa nueva contraseña&#10;        ↓&#10;11. Contraseña se actualiza en Room + Firebase&#10;        ↓&#10;12. Token se invalida (un solo uso)&#10;        ↓&#10;13. Muestra éxito y redirige a Login&#10;        ↓&#10;14. ✅ ¡Usuario puede iniciar sesión con nueva contraseña!&#10;```&#10;&#10;---&#10;&#10;##  **CÓMO PROBARLO:**&#10;&#10;### **Opción 1: Desde la app (recomendado)**&#10;&#10;1. Abre TAMATS en tu móvil&#10;2. Toca &quot;Olvidé mi contraseña&quot;&#10;3. Ingresa un correo registrado (ej: `yendermejia0@gmail.com`)&#10;4. Espera 30 segundos&#10;5. Revisa tu correo en el móvil&#10;6. **Abre el correo desde la app de Gmail/Outlook** (no desde el navegador)&#10;7. Toca el botón morado grande&#10;8. ✅ La app TAMATS se abrirá sola&#10;&#10;### **Opción 2: Copiar enlace manualmente**&#10;&#10;Si el botón no funciona:&#10;1. En el correo, toca y mantén presionado el enlace de abajo&#10;2. Selecciona &quot;Copiar enlace&quot; o &quot;Copiar dirección&quot;&#10;3. Pega el enlace en Chrome móvil&#10;4. Presiona Enter&#10;5. Android preguntará &quot;¿Abrir con TAMATS?&quot;&#10;6. Toca &quot;Abrir&quot;&#10;&#10;---&#10;&#10;## ⚠️ **IMPORTANTE PARA QUE FUNCIONE:**&#10;&#10;### ✅ **Requisitos:**&#10;&#10;1. **La app debe estar instalada** en el móvil&#10;2. **Abrir el correo desde el móvil** (no desde PC)&#10;3. **Usar la app de correo** (Gmail app, Outlook app)&#10;   - ❌ No funciona bien desde Gmail web en navegador&#10;   - ✅ Funciona desde la app nativa de Gmail&#10;4. **El token debe estar vigente** (menos de 1 hora)&#10;&#10;---&#10;&#10;##  **SEGURIDAD:**&#10;&#10;| Medida | Implementado | Descripción |&#10;|--------|--------------|-------------|&#10;| Token único | ✅ | Cada enlace usa UUID diferente |&#10;| Expiración | ✅ | 1 hora de validez |&#10;| Un solo uso | ✅ | Se invalida después de usarlo |&#10;| Email codificado | ✅ | URI encoding para seguridad |&#10;| Validación previa | ✅ | Solo correos registrados |&#10;| Contraseña cifrada | ✅ | BCrypt al guardar |&#10;&#10;---&#10;&#10;##  **CONFIGURACIÓN YA LISTA:**&#10;&#10;### ✅ **AndroidManifest.xml**&#10;```xml&#10;&lt;activity android:name=&quot;.ui.password.ResetPasswordActivity&quot;&#10;    android:exported=&quot;true&quot;&gt;&#10;    &lt;intent-filter android:autoVerify=&quot;true&quot;&gt;&#10;        &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;&#10;        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;&#10;        &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;&#10;        &lt;data android:scheme=&quot;tamats&quot; android:host=&quot;reset&quot; /&gt;&#10;    &lt;/intent-filter&gt;&#10;&lt;/activity&gt;&#10;```&#10;&#10;### ✅ **ResetPasswordActivity.kt**&#10;```kotlin&#10;// Recibe parámetros del deep link&#10;email = intent.data?.getQueryParameter(&quot;email&quot;)&#10;token = intent.data?.getQueryParameter(&quot;token&quot;)&#10;&#10;// Valida token&#10;if (!isTokenValid(token!!)) {&#10;    Toast.makeText(this, &quot;❌ Link expirado&quot;, Toast.LENGTH_LONG).show()&#10;    finish()&#10;    return&#10;}&#10;```&#10;&#10;---&#10;&#10;##  **SOLUCIÓN A PROBLEMAS COMUNES:**&#10;&#10;### ❌ **&quot;El enlace no funciona&quot;**&#10;&#10;**Causas posibles:**&#10;1. Abriste el correo desde la **PC** → Debes abrirlo desde el **móvil**&#10;2. Usaste **Gmail web** → Usa la **app de Gmail**&#10;3. Token **expiró** (más de 1 hora) → Solicita nuevo correo&#10;4. App **no instalada** → Instala TAMATS primero&#10;&#10;### ❌ **&quot;El correo no llega&quot;**&#10;&#10;**Soluciones:**&#10;1. Revisa la carpeta de **Spam**&#10;2. Espera **30-60 segundos** (el SMTP puede tardar)&#10;3. Verifica tu **conexión a internet**&#10;4. Confirma que el correo esté **registrado** en TAMATS&#10;&#10;### ❌ **&quot;Token inválido&quot;**&#10;&#10;**Causas:**&#10;1. Ya usaste ese enlace (un solo uso)&#10;2. Pasó más de 1 hora&#10;3. El email no coincide&#10;&#10;**Solución:** Solicita un nuevo correo de recuperación&#10;&#10;---&#10;&#10;##  **ARCHIVOS MODIFICADOS:**&#10;&#10;| Archivo | Cambios | Líneas |&#10;|---------|---------|--------|&#10;| `LoginActivity.kt` | Formato del deep link | ~336-340 |&#10;| `EmailService.kt` | Plantilla HTML mejorada | ~150-250 |&#10;| `DEEP_LINK_RECUPERACION_PASSWORD.md` | Documentación completa | Nuevo |&#10;| `SOLUCION_DEEP_LINK_CORREO.md` | Este archivo | Nuevo |&#10;&#10;---&#10;&#10;## ✅ **ESTADO: COMPLETADO Y LISTO**&#10;&#10;El sistema de deep links para recuperación de contraseña está **100% funcional**.&#10;&#10;**Próximos pasos:**&#10;1. Compila la app&#10;2. Instálala en tu móvil&#10;3. Prueba el flujo completo&#10;4. ¡Disfruta! &#10;&#10;---&#10;&#10;##  **SOPORTE:**&#10;&#10;Si algo no funciona:&#10;1. Revisa esta documentación&#10;2. Verifica los logs en Android Studio (Logcat)&#10;3. Busca mensajes con tag: `PasswordReset`&#10;4. Revisa que el AndroidManifest tenga el intent-filter&#10;&#10;---&#10;&#10;**Última actualización:** 2025-11-17  &#10;**Versión:** 1.0  &#10;**Estado:** ✅ Producción Ready&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/myapplication/ui/login/LoginActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/myapplication/ui/login/LoginActivity.kt" />
              <option name="originalContent" value="package com.example.myapplication.ui.login&#10;&#10;import android.content.Intent&#10;import android.os.Bundle&#10;import android.widget.EditText&#10;import android.widget.TextView&#10;import android.widget.Toast&#10;import androidx.appcompat.app.AppCompatActivity&#10;import androidx.core.content.edit&#10;import androidx.lifecycle.Lifecycle&#10;import androidx.lifecycle.lifecycleScope&#10;import com.example.myapplication.R&#10;import com.example.myapplication.admin.activities.AdminActivity&#10;import com.example.myapplication.cloud.FirebaseService&#10;import com.example.myapplication.database.AppDatabase&#10;import com.example.myapplication.model.UsuarioEntity&#10;import com.example.myapplication.ui.register.RegisterActivity&#10;import com.example.myapplication.ui.simulacion.EditProfileActivity&#10;import com.example.myapplication.util.EncryptionUtil&#10;import com.google.android.material.button.MaterialButton&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;import kotlinx.coroutines.withContext&#10;&#10;class LoginActivity : AppCompatActivity() {&#10;&#10;    companion object {&#10;        // Credenciales administrativas&#10;        private const val ADMIN_EMAIL = &quot;yendermejia0@gmail.com&quot;&#10;        private const val ADMIN_PASSWORD = &quot;Xiomy.123&quot;&#10;    }&#10;&#10;    private lateinit var etEmail: EditText&#10;    private lateinit var etPassword: EditText&#10;    private lateinit var btnLogin: MaterialButton&#10;    private lateinit var tvRegisterLink: TextView&#10;    private lateinit var tvForgotPassword: TextView&#10;&#10;    private val db by lazy { AppDatabase.getInstance(applicationContext) }&#10;    private val usuarioDao by lazy { db.usuarioDao() }&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_login)&#10;&#10;        // Si ya existe sesión guardada, ir a la actividad correspondiente&#10;        val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;        val savedEmail = prefs.getString(&quot;user_email&quot;, null)&#10;        val isAdmin = prefs.getBoolean(&quot;is_admin&quot;, false)&#10;&#10;        if (!savedEmail.isNullOrEmpty()) {&#10;            // Redirigir a AdminActivity si es admin, sino a MainActivity&#10;            val intent = if (isAdmin) {&#10;                Intent(this, AdminActivity::class.java)&#10;            } else {&#10;                Intent(this, com.example.myapplication.MainActivity::class.java).apply {&#10;                    putExtra(&quot;fragment&quot;, &quot;explore&quot;)&#10;                }&#10;            }&#10;            intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_SINGLE_TOP&#10;            startActivity(intent)&#10;            finish()&#10;            return&#10;        }&#10;&#10;        etEmail = findViewById(R.id.etEmail)&#10;        etPassword = findViewById(R.id.etPassword)&#10;        btnLogin = findViewById(R.id.btnLogin)&#10;        tvRegisterLink = findViewById(R.id.tvRegisterLink)&#10;        tvForgotPassword = findViewById(R.id.tvForgotPassword)&#10;&#10;        setupListeners()&#10;    }&#10;&#10;    private fun setupListeners() {&#10;        tvRegisterLink.setOnClickListener {&#10;            startActivity(Intent(this, RegisterActivity::class.java))&#10;        }&#10;        btnLogin.setOnClickListener {&#10;            handleLoginAttempt()&#10;        }&#10;        tvForgotPassword.setOnClickListener {&#10;            showForgotPasswordDialog()&#10;        }&#10;    }&#10;&#10;    private fun handleLoginAttempt() {&#10;        val email = etEmail.text.toString().trim()&#10;        val password = etPassword.text.toString().trim()&#10;&#10;        if (email.isEmpty() || password.isEmpty()) {&#10;            if (email.isEmpty()) etEmail.error = &quot;El correo es obligatorio.&quot;&#10;            if (password.isEmpty()) etPassword.error = &quot;La contraseña es obligatoria.&quot;&#10;            return&#10;        }&#10;&#10;        // Verificar si son credenciales de admin&#10;        if (email == ADMIN_EMAIL &amp;&amp; password == ADMIN_PASSWORD) {&#10;            navigateToAdmin()&#10;            return&#10;        }&#10;&#10;        lifecycleScope.launch {&#10;            val localUser = withContext(Dispatchers.IO) {&#10;                usuarioDao.getUserByEmail(email)&#10;            }&#10;&#10;            if (localUser != null) {&#10;                // Verificar la contraseña cifrada usando EncryptionUtil&#10;                if (EncryptionUtil.verifyPassword(password, localUser.passwordHash)) {&#10;                    // Antes de navegar, chequear estado en Firestore (por si fue bloqueado/suspendido/eliminado)&#10;                    checkUserStateAndProceed(localUser.email, localUser)&#10;                } else {&#10;                    Toast.makeText(this@LoginActivity, &quot;Credenciales incorrectas.&quot;, Toast.LENGTH_LONG).show()&#10;                }&#10;            } else {&#10;                Toast.makeText(this@LoginActivity, &quot;Buscando en la nube...&quot;, Toast.LENGTH_SHORT).show()&#10;&#10;                FirebaseService.findUserByEmail(email) { firebaseUser -&gt;&#10;                    if (!lifecycle.currentState.isAtLeast(Lifecycle.State.STARTED)) {&#10;                        return@findUserByEmail&#10;                    }&#10;&#10;                    if (firebaseUser != null &amp;&amp; EncryptionUtil.verifyPassword(password, firebaseUser.passwordHash)) {&#10;                        lifecycleScope.launch(Dispatchers.IO) {&#10;                            usuarioDao.insertar(firebaseUser)&#10;                            withContext(Dispatchers.Main) {&#10;                                // Chequear estado en Firestore antes de permitir entrada&#10;                                checkUserStateAndProceed(firebaseUser.email, firebaseUser)&#10;                            }&#10;                        }&#10;                    } else {&#10;                        // Falla la autenticación de Firebase&#10;                        // Usamos runOnUiThread para asegurar que se ejecuta en el hilo principal&#10;                        runOnUiThread {&#10;                            Toast.makeText(this@LoginActivity, &quot;Credenciales incorrectas.&quot;, Toast.LENGTH_LONG).show()&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Verifica en Firebase el estado del usuario (blocked/suspended/existence) y navega o muestra Toast con motivo&#10;     */&#10;    private fun checkUserStateAndProceed(email: String, userEntity: UsuarioEntity) {&#10;        FirebaseService.getUserProfile(email) { profileData -&gt;&#10;            runOnUiThread {&#10;                // Si profileData es null: usuario eliminado o no tiene perfil en Firestore&#10;                if (profileData == null) {&#10;                    Toast.makeText(this, &quot;No fue posible iniciar sesión: cuenta no encontrada (eliminada).&quot;, Toast.LENGTH_LONG).show()&#10;                    return@runOnUiThread&#10;                }&#10;&#10;                // Revisar campos 'blocked' y 'suspended'&#10;                val blocked = profileData[&quot;blocked&quot;] as? Boolean ?: false&#10;                val suspended = profileData[&quot;suspended&quot;] as? Boolean ?: false&#10;                val suspensionEnd = when (val v = profileData[&quot;suspensionEnd&quot;]) {&#10;                    is com.google.firebase.Timestamp -&gt; v.toDate().time&#10;                    is Number -&gt; v.toLong()&#10;                    else -&gt; null&#10;                }&#10;&#10;                if (blocked) {&#10;                    Toast.makeText(this, &quot;Tu cuenta ha sido bloqueada. Contacta al soporte para más información.&quot;, Toast.LENGTH_LONG).show()&#10;                    return@runOnUiThread&#10;                }&#10;&#10;                if (suspended) {&#10;                    // Si suspensionEnd existe y es futuro, mostrar días restantes&#10;                    if (suspensionEnd != null &amp;&amp; System.currentTimeMillis() &lt; suspensionEnd) {&#10;                        val daysLeft = ((suspensionEnd - System.currentTimeMillis()) / (1000 * 60 * 60 * 24)).toInt() + 1&#10;                        Toast.makeText(this, &quot;Tu cuenta está suspendida. Días restantes: $daysLeft&quot;, Toast.LENGTH_LONG).show()&#10;                        return@runOnUiThread&#10;                    } else {&#10;                        // Si suspensionEnd no existe o ya pasó, permitir continuar&#10;                    }&#10;                }&#10;&#10;                // Si llegó hasta aquí, el usuario está activo → proceder con el flujo normal&#10;                try {&#10;                    val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;                    prefs.edit(commit = true) {&#10;                        putString(&quot;user_email&quot;, userEntity.email)&#10;                        // name/photo se guardan posteriormente si existen&#10;                    }&#10;                } catch (e: Exception) {&#10;                    e.printStackTrace()&#10;                }&#10;&#10;                // Navegar a MainActivity o EditProfile según profileData&#10;                val intent = Intent(this, com.example.myapplication.MainActivity::class.java).apply {&#10;                    putExtra(&quot;fragment&quot;, &quot;profile&quot;)&#10;                }&#10;                intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_NEW_TASK&#10;                startActivity(intent)&#10;                finish()&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun navigateToAdmin() {&#10;        Toast.makeText(this, &quot;¡Bienvenido, Administrador!&quot;, Toast.LENGTH_LONG).show()&#10;&#10;        // Intentar autenticar en Firebase con las credenciales de admin para poder leer Firestore&#10;        val auth = com.google.firebase.auth.FirebaseAuth.getInstance()&#10;        auth.signInWithEmailAndPassword(ADMIN_EMAIL, ADMIN_PASSWORD)&#10;            .addOnCompleteListener { task -&gt;&#10;                if (task.isSuccessful) {&#10;                    // Guardar que es admin en SharedPreferences&#10;                    val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;                    prefs.edit(commit = true) {&#10;                        putString(&quot;user_email&quot;, ADMIN_EMAIL)&#10;                        putBoolean(&quot;is_admin&quot;, true)&#10;                    }&#10;&#10;                    // Ir al panel de administración&#10;                    val intent = Intent(this, AdminActivity::class.java)&#10;                    intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_NEW_TASK&#10;                    startActivity(intent)&#10;                    finish()&#10;                } else {&#10;                    // Si falla la autenticación en Firebase, mostrar mensaje y no permitir acceso&#10;                    val err = task.exception?.message ?: &quot;Error autenticando admin en Firebase&quot;&#10;                    android.util.Log.e(&quot;LoginActivity&quot;, &quot;Auth admin failed: $err&quot;)&#10;                    Toast.makeText(this, &quot;No fue posible autenticar al administrador en Firebase: $err&quot;, Toast.LENGTH_LONG).show()&#10;                }&#10;            }&#10;    }&#10;&#10;    private fun navigateToProfile(user: UsuarioEntity) {&#10;        Toast.makeText(this, &quot;¡Bienvenido, ${user.name}!&quot;, Toast.LENGTH_LONG).show()&#10;&#10;        // Verificar si el usuario ya tiene perfil en Firebase&#10;        FirebaseService.getUserProfile(user.email) { profileData -&gt;&#10;            runOnUiThread {&#10;                // Guardar el email en SharedPreferences siempre (identificador del usuario en la app)&#10;                try {&#10;                    val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;                    prefs.edit(commit = true) {&#10;                        putString(&quot;user_email&quot;, user.email)&#10;                        if (profileData != null) {&#10;                            val name = profileData[&quot;name&quot;]?.toString() ?: &quot;&quot;&#10;                            if (name.isNotEmpty()) putString(&quot;user_name&quot;, name) else remove(&quot;user_name&quot;)&#10;                            // NO guardar user_photo en SharedPreferences para evitar TransactionTooLargeException&#10;                            // La foto se cargará desde Firebase cuando sea necesaria&#10;                            remove(&quot;user_photo&quot;)&#10;                        } else {&#10;                            remove(&quot;user_name&quot;)&#10;                            remove(&quot;user_photo&quot;)&#10;                        }&#10;                    }&#10;                } catch (e: Exception) {&#10;                    e.printStackTrace()&#10;                }&#10;&#10;                // Siempre ir a MainActivity (que tiene la barra de navegación)&#10;                // Si el usuario no tiene perfil completado, irá a EditProfileActivity desde aquí&#10;                val intent = if (profileData != null) {&#10;                    // Usuario YA tiene perfil → ir a MainActivity mostrando el fragment Profile&#10;                    Intent(this, com.example.myapplication.MainActivity::class.java).apply {&#10;                        putExtra(&quot;fragment&quot;, &quot;profile&quot;)&#10;                    }&#10;                } else {&#10;                    // Usuario NO tiene perfil → ir a EditProfileActivity para completarlo&#10;                    Intent(this, EditProfileActivity::class.java).apply {&#10;                        putExtra(&quot;userEmail&quot;, user.email)&#10;                    }&#10;                }&#10;                intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_NEW_TASK&#10;                startActivity(intent)&#10;                finish()&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun showForgotPasswordDialog() {&#10;        val dialogView = layoutInflater.inflate(R.layout.dialog_forgot_password, null)&#10;        val etRecoveryEmail = dialogView.findViewById&lt;EditText&gt;(R.id.etRecoveryEmail)&#10;&#10;        val dialog = androidx.appcompat.app.AlertDialog.Builder(this)&#10;            .setView(dialogView)&#10;            .create()&#10;&#10;        dialogView.findViewById&lt;MaterialButton&gt;(R.id.btnSendRecovery).setOnClickListener {&#10;            val email = etRecoveryEmail.text.toString().trim()&#10;&#10;            if (email.isEmpty()) {&#10;                etRecoveryEmail.error = &quot;Ingresa tu correo electrónico&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (!android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches()) {&#10;                etRecoveryEmail.error = &quot;Ingresa un correo válido&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            sendPasswordResetEmail(email, dialog)&#10;        }&#10;&#10;        dialogView.findViewById&lt;MaterialButton&gt;(R.id.btnCancelRecovery).setOnClickListener {&#10;            dialog.dismiss()&#10;        }&#10;&#10;        dialog.show()&#10;    }&#10;&#10;    private fun sendPasswordResetEmail(email: String, dialog: androidx.appcompat.app.AlertDialog) {&#10;        // Mostrar loading&#10;        val btnSend = dialog.findViewById&lt;MaterialButton&gt;(R.id.btnSendRecovery)&#10;        btnSend?.isEnabled = false&#10;        btnSend?.text = &quot;Verificando...&quot;&#10;&#10;        // PRIMERO: Verificar que el correo exista en la base de datos&#10;        lifecycleScope.launch(Dispatchers.IO) {&#10;            val userExists = usuarioDao.getUserByEmail(email) != null&#10;&#10;            withContext(Dispatchers.Main) {&#10;                if (!userExists) {&#10;                    // Correo NO existe en la BD&#10;                    btnSend?.isEnabled = true&#10;                    btnSend?.text = &quot;Enviar&quot;&#10;                    Toast.makeText(&#10;                        this@LoginActivity,&#10;                        &quot;❌ No existe una cuenta registrada con este correo electrónico&quot;,&#10;                        Toast.LENGTH_LONG&#10;                    ).show()&#10;                    android.util.Log.w(&quot;PasswordReset&quot;, &quot;⚠️ Intento de recuperación para correo no registrado: $email&quot;)&#10;                    return@withContext&#10;                }&#10;&#10;                // Correo SÍ existe, continuar con el envío&#10;                btnSend?.text = &quot;Enviando...&quot;&#10;&#10;                // Generar token único de recuperación&#10;                val resetToken = java.util.UUID.randomUUID().toString()&#10;                val timestamp = System.currentTimeMillis()&#10;&#10;                // Crear link de recuperación&#10;                val resetLink = &quot;tamats://reset?token=$resetToken&amp;email=$email&quot;&#10;&#10;                // Guardar token en SharedPreferences (expira en 1 hora)&#10;                val prefs = getSharedPreferences(&quot;password_reset&quot;, MODE_PRIVATE)&#10;                prefs.edit().apply {&#10;                    putString(&quot;token_$resetToken&quot;, email)&#10;                    putLong(&quot;timestamp_$resetToken&quot;, timestamp)&#10;                    apply()&#10;                }&#10;&#10;                // Enviar correo usando SMTP (EmailService)&#10;                lifecycleScope.launch(Dispatchers.IO) {&#10;                    val emailSent = com.example.myapplication.util.EmailService.sendPasswordResetEmail(&#10;                        toEmail = email,&#10;                        resetLink = resetLink&#10;                    )&#10;&#10;                    withContext(Dispatchers.Main) {&#10;                        btnSend?.isEnabled = true&#10;                        btnSend?.text = &quot;Enviar&quot;&#10;&#10;                        if (emailSent) {&#10;                            Toast.makeText(&#10;                                this@LoginActivity,&#10;                                &quot;✅ ¡Correo enviado a $email!\nRevisa tu bandeja (puede tardar 30 seg)&quot;,&#10;                                Toast.LENGTH_LONG&#10;                            ).show()&#10;                            dialog.dismiss()&#10;                            android.util.Log.d(&quot;PasswordReset&quot;, &quot;✅ Email sent to: $email, Token: $resetToken&quot;)&#10;                        } else {&#10;                            Toast.makeText(&#10;                                this@LoginActivity,&#10;                                &quot;❌ Error al enviar. Verifica tu conexión a internet&quot;,&#10;                                Toast.LENGTH_LONG&#10;                            ).show()&#10;                            android.util.Log.e(&quot;PasswordReset&quot;, &quot;❌ Failed to send email to: $email&quot;)&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.myapplication.ui.login&#10;&#10;import android.content.Intent&#10;import android.os.Bundle&#10;import android.widget.EditText&#10;import android.widget.TextView&#10;import android.widget.Toast&#10;import androidx.appcompat.app.AppCompatActivity&#10;import androidx.core.content.edit&#10;import androidx.lifecycle.Lifecycle&#10;import androidx.lifecycle.lifecycleScope&#10;import com.example.myapplication.R&#10;import com.example.myapplication.admin.activities.AdminActivity&#10;import com.example.myapplication.cloud.FirebaseService&#10;import com.example.myapplication.database.AppDatabase&#10;import com.example.myapplication.model.UsuarioEntity&#10;import com.example.myapplication.ui.register.RegisterActivity&#10;import com.example.myapplication.ui.simulacion.EditProfileActivity&#10;import com.example.myapplication.util.EncryptionUtil&#10;import com.google.android.material.button.MaterialButton&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.launch&#10;import kotlinx.coroutines.withContext&#10;&#10;class LoginActivity : AppCompatActivity() {&#10;&#10;    companion object {&#10;        // Credenciales administrativas&#10;        private const val ADMIN_EMAIL = &quot;yendermejia0@gmail.com&quot;&#10;        private const val ADMIN_PASSWORD = &quot;Xiomy.123&quot;&#10;    }&#10;&#10;    private lateinit var etEmail: EditText&#10;    private lateinit var etPassword: EditText&#10;    private lateinit var btnLogin: MaterialButton&#10;    private lateinit var tvRegisterLink: TextView&#10;    private lateinit var tvForgotPassword: TextView&#10;&#10;    private val db by lazy { AppDatabase.getInstance(applicationContext) }&#10;    private val usuarioDao by lazy { db.usuarioDao() }&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_login)&#10;&#10;        // Si ya existe sesión guardada, ir a la actividad correspondiente&#10;        val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;        val savedEmail = prefs.getString(&quot;user_email&quot;, null)&#10;        val isAdmin = prefs.getBoolean(&quot;is_admin&quot;, false)&#10;&#10;        if (!savedEmail.isNullOrEmpty()) {&#10;            // Redirigir a AdminActivity si es admin, sino a MainActivity&#10;            val intent = if (isAdmin) {&#10;                Intent(this, AdminActivity::class.java)&#10;            } else {&#10;                Intent(this, com.example.myapplication.MainActivity::class.java).apply {&#10;                    putExtra(&quot;fragment&quot;, &quot;explore&quot;)&#10;                }&#10;            }&#10;            intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_SINGLE_TOP&#10;            startActivity(intent)&#10;            finish()&#10;            return&#10;        }&#10;&#10;        etEmail = findViewById(R.id.etEmail)&#10;        etPassword = findViewById(R.id.etPassword)&#10;        btnLogin = findViewById(R.id.btnLogin)&#10;        tvRegisterLink = findViewById(R.id.tvRegisterLink)&#10;        tvForgotPassword = findViewById(R.id.tvForgotPassword)&#10;&#10;        setupListeners()&#10;    }&#10;&#10;    private fun setupListeners() {&#10;        tvRegisterLink.setOnClickListener {&#10;            startActivity(Intent(this, RegisterActivity::class.java))&#10;        }&#10;        btnLogin.setOnClickListener {&#10;            handleLoginAttempt()&#10;        }&#10;        tvForgotPassword.setOnClickListener {&#10;            showForgotPasswordDialog()&#10;        }&#10;    }&#10;&#10;    private fun handleLoginAttempt() {&#10;        val email = etEmail.text.toString().trim()&#10;        val password = etPassword.text.toString().trim()&#10;&#10;        if (email.isEmpty() || password.isEmpty()) {&#10;            if (email.isEmpty()) etEmail.error = &quot;El correo es obligatorio.&quot;&#10;            if (password.isEmpty()) etPassword.error = &quot;La contraseña es obligatoria.&quot;&#10;            return&#10;        }&#10;&#10;        // Verificar si son credenciales de admin&#10;        if (email == ADMIN_EMAIL &amp;&amp; password == ADMIN_PASSWORD) {&#10;            navigateToAdmin()&#10;            return&#10;        }&#10;&#10;        lifecycleScope.launch {&#10;            val localUser = withContext(Dispatchers.IO) {&#10;                usuarioDao.getUserByEmail(email)&#10;            }&#10;&#10;            if (localUser != null) {&#10;                // Verificar la contraseña cifrada usando EncryptionUtil&#10;                if (EncryptionUtil.verifyPassword(password, localUser.passwordHash)) {&#10;                    // Antes de navegar, chequear estado en Firestore (por si fue bloqueado/suspendido/eliminado)&#10;                    checkUserStateAndProceed(localUser.email, localUser)&#10;                } else {&#10;                    Toast.makeText(this@LoginActivity, &quot;Credenciales incorrectas.&quot;, Toast.LENGTH_LONG).show()&#10;                }&#10;            } else {&#10;                Toast.makeText(this@LoginActivity, &quot;Buscando en la nube...&quot;, Toast.LENGTH_SHORT).show()&#10;&#10;                FirebaseService.findUserByEmail(email) { firebaseUser -&gt;&#10;                    if (!lifecycle.currentState.isAtLeast(Lifecycle.State.STARTED)) {&#10;                        return@findUserByEmail&#10;                    }&#10;&#10;                    if (firebaseUser != null &amp;&amp; EncryptionUtil.verifyPassword(password, firebaseUser.passwordHash)) {&#10;                        lifecycleScope.launch(Dispatchers.IO) {&#10;                            usuarioDao.insertar(firebaseUser)&#10;                            withContext(Dispatchers.Main) {&#10;                                // Chequear estado en Firestore antes de permitir entrada&#10;                                checkUserStateAndProceed(firebaseUser.email, firebaseUser)&#10;                            }&#10;                        }&#10;                    } else {&#10;                        // Falla la autenticación de Firebase&#10;                        // Usamos runOnUiThread para asegurar que se ejecuta en el hilo principal&#10;                        runOnUiThread {&#10;                            Toast.makeText(this@LoginActivity, &quot;Credenciales incorrectas.&quot;, Toast.LENGTH_LONG).show()&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Verifica en Firebase el estado del usuario (blocked/suspended/existence) y navega o muestra Toast con motivo&#10;     */&#10;    private fun checkUserStateAndProceed(email: String, userEntity: UsuarioEntity) {&#10;        FirebaseService.getUserProfile(email) { profileData -&gt;&#10;            runOnUiThread {&#10;                // Si profileData es null: usuario eliminado o no tiene perfil en Firestore&#10;                if (profileData == null) {&#10;                    Toast.makeText(this, &quot;No fue posible iniciar sesión: cuenta no encontrada (eliminada).&quot;, Toast.LENGTH_LONG).show()&#10;                    return@runOnUiThread&#10;                }&#10;&#10;                // Revisar campos 'blocked' y 'suspended'&#10;                val blocked = profileData[&quot;blocked&quot;] as? Boolean ?: false&#10;                val suspended = profileData[&quot;suspended&quot;] as? Boolean ?: false&#10;                val suspensionEnd = when (val v = profileData[&quot;suspensionEnd&quot;]) {&#10;                    is com.google.firebase.Timestamp -&gt; v.toDate().time&#10;                    is Number -&gt; v.toLong()&#10;                    else -&gt; null&#10;                }&#10;&#10;                if (blocked) {&#10;                    Toast.makeText(this, &quot;Tu cuenta ha sido bloqueada. Contacta al soporte para más información.&quot;, Toast.LENGTH_LONG).show()&#10;                    return@runOnUiThread&#10;                }&#10;&#10;                if (suspended) {&#10;                    // Si suspensionEnd existe y es futuro, mostrar días restantes&#10;                    if (suspensionEnd != null &amp;&amp; System.currentTimeMillis() &lt; suspensionEnd) {&#10;                        val daysLeft = ((suspensionEnd - System.currentTimeMillis()) / (1000 * 60 * 60 * 24)).toInt() + 1&#10;                        Toast.makeText(this, &quot;Tu cuenta está suspendida. Días restantes: $daysLeft&quot;, Toast.LENGTH_LONG).show()&#10;                        return@runOnUiThread&#10;                    } else {&#10;                        // Si suspensionEnd no existe o ya pasó, permitir continuar&#10;                    }&#10;                }&#10;&#10;                // Si llegó hasta aquí, el usuario está activo → proceder con el flujo normal&#10;                try {&#10;                    val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;                    prefs.edit(commit = true) {&#10;                        putString(&quot;user_email&quot;, userEntity.email)&#10;                        // name/photo se guardan posteriormente si existen&#10;                    }&#10;                } catch (e: Exception) {&#10;                    e.printStackTrace()&#10;                }&#10;&#10;                // Navegar a MainActivity o EditProfile según profileData&#10;                val intent = Intent(this, com.example.myapplication.MainActivity::class.java).apply {&#10;                    putExtra(&quot;fragment&quot;, &quot;profile&quot;)&#10;                }&#10;                intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_NEW_TASK&#10;                startActivity(intent)&#10;                finish()&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun navigateToAdmin() {&#10;        Toast.makeText(this, &quot;¡Bienvenido, Administrador!&quot;, Toast.LENGTH_LONG).show()&#10;&#10;        // Intentar autenticar en Firebase con las credenciales de admin para poder leer Firestore&#10;        val auth = com.google.firebase.auth.FirebaseAuth.getInstance()&#10;        auth.signInWithEmailAndPassword(ADMIN_EMAIL, ADMIN_PASSWORD)&#10;            .addOnCompleteListener { task -&gt;&#10;                if (task.isSuccessful) {&#10;                    // Guardar que es admin en SharedPreferences&#10;                    val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;                    prefs.edit(commit = true) {&#10;                        putString(&quot;user_email&quot;, ADMIN_EMAIL)&#10;                        putBoolean(&quot;is_admin&quot;, true)&#10;                    }&#10;&#10;                    // Ir al panel de administración&#10;                    val intent = Intent(this, AdminActivity::class.java)&#10;                    intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_NEW_TASK&#10;                    startActivity(intent)&#10;                    finish()&#10;                } else {&#10;                    // Si falla la autenticación en Firebase, mostrar mensaje y no permitir acceso&#10;                    val err = task.exception?.message ?: &quot;Error autenticando admin en Firebase&quot;&#10;                    android.util.Log.e(&quot;LoginActivity&quot;, &quot;Auth admin failed: $err&quot;)&#10;                    Toast.makeText(this, &quot;No fue posible autenticar al administrador en Firebase: $err&quot;, Toast.LENGTH_LONG).show()&#10;                }&#10;            }&#10;    }&#10;&#10;    private fun navigateToProfile(user: UsuarioEntity) {&#10;        Toast.makeText(this, &quot;¡Bienvenido, ${user.name}!&quot;, Toast.LENGTH_LONG).show()&#10;&#10;        // Verificar si el usuario ya tiene perfil en Firebase&#10;        FirebaseService.getUserProfile(user.email) { profileData -&gt;&#10;            runOnUiThread {&#10;                // Guardar el email en SharedPreferences siempre (identificador del usuario en la app)&#10;                try {&#10;                    val prefs = getSharedPreferences(&quot;user_data&quot;, MODE_PRIVATE)&#10;                    prefs.edit(commit = true) {&#10;                        putString(&quot;user_email&quot;, user.email)&#10;                        if (profileData != null) {&#10;                            val name = profileData[&quot;name&quot;]?.toString() ?: &quot;&quot;&#10;                            if (name.isNotEmpty()) putString(&quot;user_name&quot;, name) else remove(&quot;user_name&quot;)&#10;                            // NO guardar user_photo en SharedPreferences para evitar TransactionTooLargeException&#10;                            // La foto se cargará desde Firebase cuando sea necesaria&#10;                            remove(&quot;user_photo&quot;)&#10;                        } else {&#10;                            remove(&quot;user_name&quot;)&#10;                            remove(&quot;user_photo&quot;)&#10;                        }&#10;                    }&#10;                } catch (e: Exception) {&#10;                    e.printStackTrace()&#10;                }&#10;&#10;                // Siempre ir a MainActivity (que tiene la barra de navegación)&#10;                // Si el usuario no tiene perfil completado, irá a EditProfileActivity desde aquí&#10;                val intent = if (profileData != null) {&#10;                    // Usuario YA tiene perfil → ir a MainActivity mostrando el fragment Profile&#10;                    Intent(this, com.example.myapplication.MainActivity::class.java).apply {&#10;                        putExtra(&quot;fragment&quot;, &quot;profile&quot;)&#10;                    }&#10;                } else {&#10;                    // Usuario NO tiene perfil → ir a EditProfileActivity para completarlo&#10;                    Intent(this, EditProfileActivity::class.java).apply {&#10;                        putExtra(&quot;userEmail&quot;, user.email)&#10;                    }&#10;                }&#10;                intent.flags = Intent.FLAG_ACTIVITY_CLEAR_TOP or Intent.FLAG_ACTIVITY_NEW_TASK&#10;                startActivity(intent)&#10;                finish()&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun showForgotPasswordDialog() {&#10;        val dialogView = layoutInflater.inflate(R.layout.dialog_forgot_password, null)&#10;        val etRecoveryEmail = dialogView.findViewById&lt;EditText&gt;(R.id.etRecoveryEmail)&#10;&#10;        val dialog = androidx.appcompat.app.AlertDialog.Builder(this)&#10;            .setView(dialogView)&#10;            .create()&#10;&#10;        dialogView.findViewById&lt;MaterialButton&gt;(R.id.btnSendRecovery).setOnClickListener {&#10;            val email = etRecoveryEmail.text.toString().trim()&#10;&#10;            if (email.isEmpty()) {&#10;                etRecoveryEmail.error = &quot;Ingresa tu correo electrónico&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (!android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches()) {&#10;                etRecoveryEmail.error = &quot;Ingresa un correo válido&quot;&#10;                return@setOnClickListener&#10;            }&#10;&#10;            sendPasswordResetEmail(email, dialog)&#10;        }&#10;&#10;        dialogView.findViewById&lt;MaterialButton&gt;(R.id.btnCancelRecovery).setOnClickListener {&#10;            dialog.dismiss()&#10;        }&#10;&#10;        dialog.show()&#10;    }&#10;&#10;    private fun sendPasswordResetEmail(email: String, dialog: androidx.appcompat.app.AlertDialog) {&#10;        // Mostrar loading&#10;        val btnSend = dialog.findViewById&lt;MaterialButton&gt;(R.id.btnSendRecovery)&#10;        btnSend?.isEnabled = false&#10;        btnSend?.text = &quot;Verificando...&quot;&#10;&#10;        // PRIMERO: Verificar que el correo exista en la base de datos&#10;        lifecycleScope.launch(Dispatchers.IO) {&#10;            val userExists = usuarioDao.getUserByEmail(email) != null&#10;&#10;            withContext(Dispatchers.Main) {&#10;                if (!userExists) {&#10;                    // Correo NO existe en la BD&#10;                    btnSend?.isEnabled = true&#10;                    btnSend?.text = &quot;Enviar&quot;&#10;                    Toast.makeText(&#10;                        this@LoginActivity,&#10;                        &quot;❌ No existe una cuenta registrada con este correo electrónico&quot;,&#10;                        Toast.LENGTH_LONG&#10;                    ).show()&#10;                    android.util.Log.w(&quot;PasswordReset&quot;, &quot;⚠️ Intento de recuperación para correo no registrado: $email&quot;)&#10;                    return@withContext&#10;                }&#10;&#10;                // Correo SÍ existe, continuar con el envío&#10;                btnSend?.text = &quot;Enviando...&quot;&#10;&#10;                // Generar token único de recuperación&#10;                val resetToken = java.util.UUID.randomUUID().toString()&#10;                val timestamp = System.currentTimeMillis()&#10;&#10;                // Crear link de recuperación - Deep Link directo&#10;                val deepLink = &quot;tamats://reset?token=$resetToken&amp;email=${android.net.Uri.encode(email)}&quot;&#10;                val resetLink = deepLink&#10;&#10;                // Guardar token en SharedPreferences (expira en 1 hora)&#10;                val prefs = getSharedPreferences(&quot;password_reset&quot;, MODE_PRIVATE)&#10;                prefs.edit().apply {&#10;                    putString(&quot;token_$resetToken&quot;, email)&#10;                    putLong(&quot;timestamp_$resetToken&quot;, timestamp)&#10;                    apply()&#10;                }&#10;&#10;                // Enviar correo usando SMTP (EmailService)&#10;                lifecycleScope.launch(Dispatchers.IO) {&#10;                    val emailSent = com.example.myapplication.util.EmailService.sendPasswordResetEmail(&#10;                        toEmail = email,&#10;                        resetLink = resetLink&#10;                    )&#10;&#10;                    withContext(Dispatchers.Main) {&#10;                        btnSend?.isEnabled = true&#10;                        btnSend?.text = &quot;Enviar&quot;&#10;&#10;                        if (emailSent) {&#10;                            Toast.makeText(&#10;                                this@LoginActivity,&#10;                                &quot;✅ ¡Correo enviado a $email!\nRevisa tu bandeja (puede tardar 30 seg)&quot;,&#10;                                Toast.LENGTH_LONG&#10;                            ).show()&#10;                            dialog.dismiss()&#10;                            android.util.Log.d(&quot;PasswordReset&quot;, &quot;✅ Email sent to: $email, Token: $resetToken&quot;)&#10;                        } else {&#10;                            Toast.makeText(&#10;                                this@LoginActivity,&#10;                                &quot;❌ Error al enviar. Verifica tu conexión a internet&quot;,&#10;                                Toast.LENGTH_LONG&#10;                            ).show()&#10;                            android.util.Log.e(&quot;PasswordReset&quot;, &quot;❌ Failed to send email to: $email&quot;)&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/myapplication/util/EmailService.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/myapplication/util/EmailService.kt" />
              <option name="originalContent" value="package com.example.myapplication.util&#10;&#10;import android.os.Handler&#10;import android.os.Looper&#10;import android.util.Log&#10;import java.util.Properties&#10;import javax.mail.Authenticator&#10;import javax.mail.Message&#10;import javax.mail.MessagingException&#10;import javax.mail.PasswordAuthentication&#10;import javax.mail.Session&#10;import javax.mail.Transport&#10;import javax.mail.internet.InternetAddress&#10;import javax.mail.internet.MimeMessage&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.withContext&#10;&#10;/**&#10; * Servicio para envío de correos usando SMTP (Gmail)&#10; *&#10; * CONFIGURACIÓN NECESARIA:&#10; * 1. Crear una cuenta de Gmail&#10; * 2. Habilitar &quot;Contraseñas de aplicaciones&quot; en Google Account&#10; * 3. Usar esa contraseña aquí (NO la contraseña normal)&#10; */&#10;object EmailService {&#10;&#10;    // ⚙️ CONFIGURACIÓN - Email configurado&#10;    private const val SMTP_HOST = &quot;smtp.gmail.com&quot;&#10;    private const val SMTP_PORT = &quot;587&quot;&#10;    private const val EMAIL_FROM = &quot;yendermejia0@gmail.com&quot;&#10;    private const val EMAIL_PASSWORD = &quot;wqcolfegitsiylpx&quot;&#10;    private const val EMAIL_FROM_NAME = &quot;TAMATS App&quot;&#10;&#10;    /**&#10;     * Enviar correo de bienvenida al registrarse&#10;     */&#10;    suspend fun sendWelcomeEmail(toEmail: String, userName: String): Boolean {&#10;        return sendEmail(&#10;            to = toEmail,&#10;            subject = &quot; ¡Bienvenido a TAMATS, $userName!&quot;,&#10;            body = createWelcomeEmailBody(userName)&#10;        )&#10;    }&#10;&#10;    /**&#10;     * Enviar correo de recuperación de contraseña&#10;     */&#10;    suspend fun sendPasswordResetEmail(toEmail: String, resetLink: String): Boolean {&#10;        return sendEmail(&#10;            to = toEmail,&#10;            subject = &quot; Recupera tu cuenta de TAMATS&quot;,&#10;            body = createPasswordResetEmailBody(resetLink)&#10;        )&#10;    }&#10;&#10;    /**&#10;     * Función genérica para enviar correos&#10;     */&#10;    private suspend fun sendEmail(to: String, subject: String, body: String): Boolean = withContext(Dispatchers.IO) {&#10;        try {&#10;            // Configurar propiedades SMTP&#10;            val props = Properties().apply {&#10;                put(&quot;mail.smtp.host&quot;, SMTP_HOST)&#10;                put(&quot;mail.smtp.port&quot;, SMTP_PORT)&#10;                put(&quot;mail.smtp.auth&quot;, &quot;true&quot;)&#10;                put(&quot;mail.smtp.starttls.enable&quot;, &quot;true&quot;)&#10;                put(&quot;mail.smtp.starttls.required&quot;, &quot;true&quot;)&#10;                put(&quot;mail.smtp.ssl.protocols&quot;, &quot;TLSv1.2&quot;)&#10;            }&#10;&#10;            // Crear sesión con autenticación&#10;            val session = Session.getInstance(props, object : Authenticator() {&#10;                override fun getPasswordAuthentication(): PasswordAuthentication {&#10;                    return PasswordAuthentication(EMAIL_FROM, EMAIL_PASSWORD)&#10;                }&#10;            })&#10;&#10;            // Crear mensaje&#10;            val message = MimeMessage(session).apply {&#10;                setFrom(InternetAddress(EMAIL_FROM, EMAIL_FROM_NAME))&#10;                addRecipient(Message.RecipientType.TO, InternetAddress(to))&#10;                setSubject(subject, &quot;UTF-8&quot;)&#10;                setText(body, &quot;UTF-8&quot;, &quot;html&quot;)&#10;            }&#10;&#10;            // Enviar&#10;            Transport.send(message)&#10;            Log.d(&quot;EmailService&quot;, &quot;✅ Correo enviado exitosamente a: $to&quot;)&#10;            true&#10;        } catch (e: MessagingException) {&#10;            Log.e(&quot;EmailService&quot;, &quot;❌ Error enviando correo: ${e.message}&quot;, e)&#10;            false&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;EmailService&quot;, &quot;❌ Error inesperado: ${e.message}&quot;, e)&#10;            false&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Plantilla HTML para correo de bienvenida&#10;     */&#10;    private fun createWelcomeEmailBody(userName: String): String {&#10;        return &quot;&quot;&quot;&#10;            &lt;!DOCTYPE html&gt;&#10;            &lt;html&gt;&#10;            &lt;head&gt;&#10;                &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;                &lt;style&gt;&#10;                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }&#10;                    .container { max-width: 600px; margin: 0 auto; padding: 20px; }&#10;                    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }&#10;                    .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }&#10;                    .button { display: inline-block; background: #9C27B0; color: white; padding: 12px 30px; text-decoration: none; border-radius: 25px; margin: 20px 0; }&#10;                    .footer { text-align: center; margin-top: 20px; color: #777; font-size: 12px; }&#10;                &lt;/style&gt;&#10;            &lt;/head&gt;&#10;            &lt;body&gt;&#10;                &lt;div class=&quot;container&quot;&gt;&#10;                    &lt;div class=&quot;header&quot;&gt;&#10;                        &lt;h1&gt; TAMATS&lt;/h1&gt;&#10;                        &lt;h2&gt;¡Bienvenido!&lt;/h2&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;content&quot;&gt;&#10;                        &lt;h2&gt;¡Hola, $userName! &lt;/h2&gt;&#10;                        &lt;p&gt;¡Gracias por unirte a &lt;strong&gt;TAMATS&lt;/strong&gt;!&lt;/p&gt;&#10;                        &lt;p&gt;Estamos emocionados de tenerte con nosotros. Ahora formas parte de una comunidad increíble donde podrás:&lt;/p&gt;&#10;                        &lt;ul&gt;&#10;                            &lt;li&gt;✨ Conocer personas increíbles&lt;/li&gt;&#10;                            &lt;li&gt; Chatear y hacer amigos&lt;/li&gt;&#10;                            &lt;li&gt; Compartir tus intereses&lt;/li&gt;&#10;                            &lt;li&gt; Crear historias y publicaciones&lt;/li&gt;&#10;                        &lt;/ul&gt;&#10;                        &lt;p&gt;Tu cuenta ha sido creada exitosamente. ¡Ya puedes empezar a explorar!&lt;/p&gt;&#10;                        &lt;p style=&quot;text-align: center;&quot;&gt;&#10;                            &lt;strong&gt;¡Que disfrutes tu experiencia en TAMATS! &lt;/strong&gt;&#10;                        &lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;footer&quot;&gt;&#10;                        &lt;p&gt;© 2025 TAMATS. Todos los derechos reservados.&lt;/p&gt;&#10;                        &lt;p&gt;Este es un correo automático, por favor no respondas a este mensaje.&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/body&gt;&#10;            &lt;/html&gt;&#10;        &quot;&quot;&quot;.trimIndent()&#10;    }&#10;&#10;    /**&#10;     * Plantilla HTML para correo de recuperación de contraseña&#10;     */&#10;    private fun createPasswordResetEmailBody(resetLink: String): String {&#10;        return &quot;&quot;&quot;&#10;            &lt;!DOCTYPE html&gt;&#10;            &lt;html&gt;&#10;            &lt;head&gt;&#10;                &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;                &lt;style&gt;&#10;                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }&#10;                    .container { max-width: 600px; margin: 0 auto; padding: 20px; }&#10;                    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }&#10;                    .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }&#10;                    .button { display: inline-block; background: #9C27B0; color: white; padding: 12px 30px; text-decoration: none; border-radius: 25px; margin: 20px 0; }&#10;                    .footer { text-align: center; margin-top: 20px; color: #777; font-size: 12px; }&#10;                    .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin: 15px 0; }&#10;                &lt;/style&gt;&#10;            &lt;/head&gt;&#10;            &lt;body&gt;&#10;                &lt;div class=&quot;container&quot;&gt;&#10;                    &lt;div class=&quot;header&quot;&gt;&#10;                        &lt;h1&gt; TAMATS&lt;/h1&gt;&#10;                        &lt;h2&gt;Recuperación de Contraseña&lt;/h2&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;content&quot;&gt;&#10;                        &lt;h2&gt;¡Hola!&lt;/h2&gt;&#10;                        &lt;p&gt;Recibimos una solicitud para restablecer la contraseña de tu cuenta en &lt;strong&gt;TAMATS&lt;/strong&gt;.&lt;/p&gt;&#10;                        &lt;div class=&quot;warning&quot;&gt;&#10;                            &lt;strong&gt;⚠️ Importante:&lt;/strong&gt; Si NO solicitaste este cambio, ignora este correo y tu contraseña permanecerá segura.&#10;                        &lt;/div&gt;&#10;                        &lt;p&gt;Para crear una nueva contraseña, haz clic en el siguiente botón:&lt;/p&gt;&#10;                        &lt;p style=&quot;text-align: center;&quot;&gt;&#10;                            &lt;a href=&quot;$resetLink&quot; class=&quot;button&quot;&gt;Restablecer Contraseña&lt;/a&gt;&#10;                        &lt;/p&gt;&#10;                        &lt;p&gt;&lt;small&gt;O copia y pega este enlace en tu navegador:&lt;/small&gt;&lt;br&gt;&#10;                        &lt;small style=&quot;color: #9C27B0; word-break: break-all;&quot;&gt;$resetLink&lt;/small&gt;&lt;/p&gt;&#10;                        &lt;p&gt;&lt;strong&gt;Este enlace expirará en 1 hora&lt;/strong&gt; por motivos de seguridad.&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;footer&quot;&gt;&#10;                        &lt;p&gt; Gracias por ser parte de TAMATS&lt;/p&gt;&#10;                        &lt;p&gt;© 2025 TAMATS. Todos los derechos reservados.&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/body&gt;&#10;            &lt;/html&gt;&#10;        &quot;&quot;&quot;.trimIndent()&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.myapplication.util&#10;&#10;import android.os.Handler&#10;import android.os.Looper&#10;import android.util.Log&#10;import java.util.Properties&#10;import javax.mail.Authenticator&#10;import javax.mail.Message&#10;import javax.mail.MessagingException&#10;import javax.mail.PasswordAuthentication&#10;import javax.mail.Session&#10;import javax.mail.Transport&#10;import javax.mail.internet.InternetAddress&#10;import javax.mail.internet.MimeMessage&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.withContext&#10;&#10;/**&#10; * Servicio para envío de correos usando SMTP (Gmail)&#10; *&#10; * CONFIGURACIÓN NECESARIA:&#10; * 1. Crear una cuenta de Gmail&#10; * 2. Habilitar &quot;Contraseñas de aplicaciones&quot; en Google Account&#10; * 3. Usar esa contraseña aquí (NO la contraseña normal)&#10; */&#10;object EmailService {&#10;&#10;    // ⚙️ CONFIGURACIÓN - Email configurado&#10;    private const val SMTP_HOST = &quot;smtp.gmail.com&quot;&#10;    private const val SMTP_PORT = &quot;587&quot;&#10;    private const val EMAIL_FROM = &quot;yendermejia0@gmail.com&quot;&#10;    private const val EMAIL_PASSWORD = &quot;wqcolfegitsiylpx&quot;&#10;    private const val EMAIL_FROM_NAME = &quot;TAMATS App&quot;&#10;&#10;    /**&#10;     * Enviar correo de bienvenida al registrarse&#10;     */&#10;    suspend fun sendWelcomeEmail(toEmail: String, userName: String): Boolean {&#10;        return sendEmail(&#10;            to = toEmail,&#10;            subject = &quot; ¡Bienvenido a TAMATS, $userName!&quot;,&#10;            body = createWelcomeEmailBody(userName)&#10;        )&#10;    }&#10;&#10;    /**&#10;     * Enviar correo de recuperación de contraseña&#10;     */&#10;    suspend fun sendPasswordResetEmail(toEmail: String, resetLink: String): Boolean {&#10;        return sendEmail(&#10;            to = toEmail,&#10;            subject = &quot; Recupera tu cuenta de TAMATS&quot;,&#10;            body = createPasswordResetEmailBody(resetLink)&#10;        )&#10;    }&#10;&#10;    /**&#10;     * Función genérica para enviar correos&#10;     */&#10;    private suspend fun sendEmail(to: String, subject: String, body: String): Boolean = withContext(Dispatchers.IO) {&#10;        try {&#10;            // Configurar propiedades SMTP&#10;            val props = Properties().apply {&#10;                put(&quot;mail.smtp.host&quot;, SMTP_HOST)&#10;                put(&quot;mail.smtp.port&quot;, SMTP_PORT)&#10;                put(&quot;mail.smtp.auth&quot;, &quot;true&quot;)&#10;                put(&quot;mail.smtp.starttls.enable&quot;, &quot;true&quot;)&#10;                put(&quot;mail.smtp.starttls.required&quot;, &quot;true&quot;)&#10;                put(&quot;mail.smtp.ssl.protocols&quot;, &quot;TLSv1.2&quot;)&#10;            }&#10;&#10;            // Crear sesión con autenticación&#10;            val session = Session.getInstance(props, object : Authenticator() {&#10;                override fun getPasswordAuthentication(): PasswordAuthentication {&#10;                    return PasswordAuthentication(EMAIL_FROM, EMAIL_PASSWORD)&#10;                }&#10;            })&#10;&#10;            // Crear mensaje&#10;            val message = MimeMessage(session).apply {&#10;                setFrom(InternetAddress(EMAIL_FROM, EMAIL_FROM_NAME))&#10;                addRecipient(Message.RecipientType.TO, InternetAddress(to))&#10;                setSubject(subject, &quot;UTF-8&quot;)&#10;                setText(body, &quot;UTF-8&quot;, &quot;html&quot;)&#10;            }&#10;&#10;            // Enviar&#10;            Transport.send(message)&#10;            Log.d(&quot;EmailService&quot;, &quot;✅ Correo enviado exitosamente a: $to&quot;)&#10;            true&#10;        } catch (e: MessagingException) {&#10;            Log.e(&quot;EmailService&quot;, &quot;❌ Error enviando correo: ${e.message}&quot;, e)&#10;            false&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;EmailService&quot;, &quot;❌ Error inesperado: ${e.message}&quot;, e)&#10;            false&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Plantilla HTML para correo de bienvenida&#10;     */&#10;    private fun createWelcomeEmailBody(userName: String): String {&#10;        return &quot;&quot;&quot;&#10;            &lt;!DOCTYPE html&gt;&#10;            &lt;html&gt;&#10;            &lt;head&gt;&#10;                &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;                &lt;style&gt;&#10;                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }&#10;                    .container { max-width: 600px; margin: 0 auto; padding: 20px; }&#10;                    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }&#10;                    .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }&#10;                    .button { display: inline-block; background: #9C27B0; color: white; padding: 12px 30px; text-decoration: none; border-radius: 25px; margin: 20px 0; }&#10;                    .footer { text-align: center; margin-top: 20px; color: #777; font-size: 12px; }&#10;                &lt;/style&gt;&#10;            &lt;/head&gt;&#10;            &lt;body&gt;&#10;                &lt;div class=&quot;container&quot;&gt;&#10;                    &lt;div class=&quot;header&quot;&gt;&#10;                        &lt;h1&gt; TAMATS&lt;/h1&gt;&#10;                        &lt;h2&gt;¡Bienvenido!&lt;/h2&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;content&quot;&gt;&#10;                        &lt;h2&gt;¡Hola, $userName! &lt;/h2&gt;&#10;                        &lt;p&gt;¡Gracias por unirte a &lt;strong&gt;TAMATS&lt;/strong&gt;!&lt;/p&gt;&#10;                        &lt;p&gt;Estamos emocionados de tenerte con nosotros. Ahora formas parte de una comunidad increíble donde podrás:&lt;/p&gt;&#10;                        &lt;ul&gt;&#10;                            &lt;li&gt;✨ Conocer personas increíbles&lt;/li&gt;&#10;                            &lt;li&gt; Chatear y hacer amigos&lt;/li&gt;&#10;                            &lt;li&gt; Compartir tus intereses&lt;/li&gt;&#10;                            &lt;li&gt; Crear historias y publicaciones&lt;/li&gt;&#10;                        &lt;/ul&gt;&#10;                        &lt;p&gt;Tu cuenta ha sido creada exitosamente. ¡Ya puedes empezar a explorar!&lt;/p&gt;&#10;                        &lt;p style=&quot;text-align: center;&quot;&gt;&#10;                            &lt;strong&gt;¡Que disfrutes tu experiencia en TAMATS! &lt;/strong&gt;&#10;                        &lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;footer&quot;&gt;&#10;                        &lt;p&gt;© 2025 TAMATS. Todos los derechos reservados.&lt;/p&gt;&#10;                        &lt;p&gt;Este es un correo automático, por favor no respondas a este mensaje.&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/body&gt;&#10;            &lt;/html&gt;&#10;        &quot;&quot;&quot;.trimIndent()&#10;    }&#10;&#10;    /**&#10;     * Plantilla HTML para correo de recuperación de contraseña&#10;     */&#10;    private fun createPasswordResetEmailBody(resetLink: String): String {&#10;        return &quot;&quot;&quot;&#10;            &lt;!DOCTYPE html&gt;&#10;            &lt;html&gt;&#10;            &lt;head&gt;&#10;                &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;                &lt;style&gt;&#10;                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }&#10;                    .container { max-width: 600px; margin: 0 auto; padding: 20px; }&#10;                    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }&#10;                    .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }&#10;                    .button { &#10;                        display: inline-block; &#10;                        background: #9C27B0; &#10;                        color: white !important; &#10;                        padding: 16px 40px; &#10;                        text-decoration: none; &#10;                        border-radius: 25px; &#10;                        margin: 20px 0;&#10;                        font-size: 16px;&#10;                        font-weight: bold;&#10;                        box-shadow: 0 4px 6px rgba(156, 39, 176, 0.3);&#10;                    }&#10;                    .button:hover { background: #7B1FA2; }&#10;                    .footer { text-align: center; margin-top: 20px; color: #777; font-size: 12px; }&#10;                    .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0; border-radius: 4px; }&#10;                    .steps { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }&#10;                    .step { margin: 10px 0; padding-left: 25px; position: relative; }&#10;                    .step:before { content: &quot;✓&quot;; position: absolute; left: 0; color: #9C27B0; font-weight: bold; }&#10;                    .link-box { &#10;                        background: white; &#10;                        border: 2px dashed #9C27B0; &#10;                        padding: 15px; &#10;                        margin: 20px 0; &#10;                        border-radius: 8px;&#10;                        word-break: break-all;&#10;                        font-family: monospace;&#10;                        font-size: 12px;&#10;                        color: #9C27B0;&#10;                    }&#10;                    .info-box {&#10;                        background: #e3f2fd;&#10;                        border-left: 4px solid #2196F3;&#10;                        padding: 15px;&#10;                        margin: 15px 0;&#10;                        border-radius: 4px;&#10;                    }&#10;                &lt;/style&gt;&#10;            &lt;/head&gt;&#10;            &lt;body&gt;&#10;                &lt;div class=&quot;container&quot;&gt;&#10;                    &lt;div class=&quot;header&quot;&gt;&#10;                        &lt;h1&gt; TAMATS&lt;/h1&gt;&#10;                        &lt;h2&gt;Recuperación de Contraseña&lt;/h2&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;content&quot;&gt;&#10;                        &lt;h2&gt;¡Hola!&lt;/h2&gt;&#10;                        &lt;p&gt;Recibimos una solicitud para restablecer la contraseña de tu cuenta en &lt;strong&gt;TAMATS&lt;/strong&gt;.&lt;/p&gt;&#10;                        &#10;                        &lt;div class=&quot;warning&quot;&gt;&#10;                            &lt;strong&gt;⚠️ Importante:&lt;/strong&gt; Si NO solicitaste este cambio, ignora este correo y tu contraseña permanecerá segura.&#10;                        &lt;/div&gt;&#10;                        &#10;                        &lt;div class=&quot;steps&quot;&gt;&#10;                            &lt;h3 style=&quot;margin-top: 0; color: #9C27B0;&quot;&gt; Opción 1 - Click directo (recomendado):&lt;/h3&gt;&#10;                            &lt;div class=&quot;step&quot;&gt;Abre este correo desde tu dispositivo móvil con TAMATS instalada&lt;/div&gt;&#10;                            &lt;div class=&quot;step&quot;&gt;Toca el botón morado de abajo&lt;/div&gt;&#10;                            &lt;div class=&quot;step&quot;&gt;La app se abrirá automáticamente&lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                        &#10;                        &lt;p style=&quot;text-align: center; margin: 30px 0;&quot;&gt;&#10;                            &lt;a href=&quot;$resetLink&quot; class=&quot;button&quot; style=&quot;color: white;&quot;&gt; Abrir TAMATS y Cambiar Contraseña&lt;/a&gt;&#10;                        &lt;/p&gt;&#10;                        &#10;                        &lt;div class=&quot;info-box&quot;&gt;&#10;                            &lt;h3 style=&quot;margin-top: 0; color: #2196F3;&quot;&gt; Opción 2 - Si el botón no funciona:&lt;/h3&gt;&#10;                            &lt;p style=&quot;margin: 5px 0;&quot;&gt;1. Copia el siguiente enlace (mantén presionado y selecciona &quot;Copiar&quot;):&lt;/p&gt;&#10;                            &lt;div class=&quot;link-box&quot;&gt;$resetLink&lt;/div&gt;&#10;                            &lt;p style=&quot;margin: 5px 0;&quot;&gt;2. Abre la app TAMATS manualmente&lt;/p&gt;&#10;                            &lt;p style=&quot;margin: 5px 0;&quot;&gt;3. Ve a &quot;Olvidé mi contraseña&quot;&lt;/p&gt;&#10;                            &lt;p style=&quot;margin: 5px 0;&quot;&gt;4. Pega el enlace cuando se te solicite (próximamente)&lt;/p&gt;&#10;                        &lt;/div&gt;&#10;                        &#10;                        &lt;p style=&quot;font-size: 12px; color: #666; text-align: center; margin-top: 30px;&quot;&gt;&#10;                            &lt;strong&gt;⏰ Este enlace expirará en 1 hora&lt;/strong&gt; por motivos de seguridad.&#10;                        &lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;footer&quot;&gt;&#10;                        &lt;p&gt; Gracias por ser parte de TAMATS&lt;/p&gt;&#10;                        &lt;p&gt;© 2025 TAMATS. Todos los derechos reservados.&lt;/p&gt;&#10;                        &lt;p style=&quot;font-size: 10px; margin-top: 10px;&quot;&gt;Este es un correo automático, por favor no respondas.&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/body&gt;&#10;            &lt;/html&gt;&#10;        &quot;&quot;&quot;.trimIndent()&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>